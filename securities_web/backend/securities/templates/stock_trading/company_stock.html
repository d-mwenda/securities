{% load humanize %} {% load custom_humanize %}
<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">

    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="icon.png">
    <!-- Place favicon.ico in the root directory -->

    <!-- <link rel="stylesheet" href="css/normalize.css"> -->
    <link rel="stylesheet" href="css/main.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <meta name="theme-color" content="#fafafa">
    <style>
        /* header {
            border-color: black;
            border-style: dotted;
        } */
    </style>
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-md navbar-light fixed-top " style="background-color: #e3f2fd;">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">App Template</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsible-nav" aria-controls="collapsible-nav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                <div class="collapse navbar-collapse justify-content-end" id="collapsible-nav">
                    <ul class="navbar-nav float-end">
                        <li class="nav-item"><a class="nav-link " href=" ">Home</a></li>
                        <li class="nav-item"><a class="nav-link " href=" ">About</a></li>
                        <li class="nav-item"><a class="nav-link " href=" ">Contact</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main class="container-fluid" role="main">
        <div class="container text-center pt-5">
            <h1 class="mt-5" data-country="{{company.securities_exchange.country.slug}}" data-bourse="{{company.securities_exchange.slug}}" data-ticker="{{company.ticker_symbol}}">{{company.name}}</h1>
        </div>
        <div class="row justify-content-center py-4 text-center">
            <div class="col-xs-6 col-md-2">
                <div class="card border-0">
                    <div class="card-body" data-price>
                        <p class="card-text">Price</p>
                        <span class="card-text fs-6">Kes</span>
                        <span class="card-text fs-3">{{company.latest_price}}</span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-2">
                <div class="card border-0">
                    <div class="card-body" data-price>
                        <p class="card-text">Change</p>
                        <span class="card-text fs-3">{{company.price_change.0}}</span>
                        <span class="card-text fs-3">({{company.price_change.1}}&#37;)</span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-2">
                <div class="card border-0">
                    <div class="card-body" data-market-cap>
                        <p class="card-text">Market Cap</p>
                        <span class="card-text fs-6">Kes</span>
                        <span class="card-text fs-3">{{company.market_cap | shortintword}}</span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-2">
                <div class="card border-0">
                    <div class="card-body">
                        <p class="card-text">Volume</p>
                        <span class="card-text fs-3">{{company.latest_trading_volume |  shortintword}}</span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-2">
                <div class="card border-0">
                    <div class="card-body">
                        <p class="card-text">Day Range (FIX ME)</p>
                        <span class="card-text fs-3">28.1 - 43.55</span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 col-md-2">
                <div class="card border-0">
                    <div class="card-body">
                        <p class="card-text">52 Week Range</p>
                        <span class="card-text fs-3">{{company.year_range.0}} - {{company.year_range.1}}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-xs-12 col-md-8">
                <canvas id="myChart" width="800" height="400"></canvas>
            </div>
        </div>
        <div class="row justify-content-center mt-5">
            <div class="col-xs-12 col-sm-6 col-md-4">
                <table class="table table-borderless">
                    <tbody>
                        <tr>
                            <td>Earning per Share</td>
                            <td>Kes 5</td>
                        </tr>
                        <tr>
                            <td>Outstanding Shares</td>
                            <td>{{company.shares_issued | intcomma}}</td>
                        </tr>
                        <tr>
                            <td>Price Earning Ratio</td>
                            <td>18%</td>
                        </tr>
                        <tr>
                            <td>Dividend</td>
                            <td>Kes 2.5</td>
                        </tr>
                        <tr>
                            <td>Dividend Yield</td>
                            <td>--</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    <footer class="footer" style="height: 60px; line-height: 60px; background-color:lightblue;">
        <div class="container">
            <span class="text-muted">Place sticky footer content here.</span>
        </div>
    </footer>
    <!-- 
    <script src="js/main.js "></script> -->

    <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
    <script>
        window.ga = function() {
            ga.q.push(arguments)
        };
        ga.q = [];
        ga.l = +new Date;
        ga('create', 'UA-XXXXX-Y', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('set', 'transport', 'beacon');
        ga('send', 'pageview')
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js " integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf " crossorigin="anonymous "></script>
    <script src="https://www.google-analytics.com/analytics.js " async></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- chartJS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.2.1/dist/chart.min.js"></script>

    <script>
        // CHART SCRIPT:0

        // CHART SCRIPT:0
    </script>
    <script>
        $(document).ready(function() {
            let ticker = $("[data-ticker]").data("ticker");
            let bourse = $("[data-ticker]").data("bourse");
            let country = $("[data-ticker]").data("country");
            let values;
            let labels = [];
            let prices = [];

            $.ajax({
                url: '/api/stock-trading/' + country + '/' + bourse + '/' + ticker,
                dataType: 'json',
                success: function(stock_data) {
                    console.log(stock_data);

                    let labels = [];
                    let prices = [];

                    // Chart
                    var x
                    for (x of stock_data) {
                        labels.unshift(x['date']);
                        prices.unshift(x['closing_price']);
                        console.log(x['date']);
                        console.log(x['closing_price']);
                    }
                    const data = {
                        labels: labels,
                        datasets: [{
                            label: 'Stock Price History',
                            backgroundColor: 'rgb(255, 99, 132)',
                            borderColor: 'rgb(255, 99, 132)',
                            data: prices,
                        }]
                    };
                    // </block:setup>

                    // <block:config:0>
                    const config = {
                        type: 'line',
                        data,
                        options: {}
                    };
                    // </block:config>

                    // module.exports = {
                    //     actions: [],
                    //     config: config,
                    // };

                    var myChart = new Chart(
                        document.getElementById('myChart'),
                        config
                    );
                }
            });


        });
    </script>
    <script>
    </script>
</body>

</html>